(function(){function n(e){var t=e.children,n,r,i=e.children.length,s,o,u=/list-style-type:(.*?)(?:;|$)/,a=CKEDITOR.plugins.pastefromword.filters.stylesFilter;r=e.attributes;if(u.exec(r.style))return;for(var f=0;f<i;f++){n=t[f];if(n.attributes.value&&Number(n.attributes.value)==f+1)delete n.attributes.value;s=u.exec(n.attributes.style);if(s){if(s[1]==o||!o)o=s[1];else{o=null;break}}}if(o){for(f=0;f<i;f++){r=t[f].attributes;r.style&&(r.style=a([["list-style-type"]])(r.style)||"")}e.addStyle("list-style-type",o)}}function p(e){e=e.toUpperCase();var t=c.length,n=0;for(var r=0;r<t;++r){for(var i=c[r],s=i[1].length;e.substr(0,s)==i[1];e=e.substr(s))n+=i[0]}return n}function d(e){e=e.toUpperCase();var t=h.length,n=1;for(var r=1;e.length>0;r*=t){n+=h.indexOf(e.charAt(e.length-1))*r;e=e.substr(0,e.length-1)}return n}var e=CKEDITOR.htmlParser.fragment.prototype,t=CKEDITOR.htmlParser.element.prototype;e.onlyChild=t.onlyChild=function(){var e=this.children,t=e.length,n=t==1&&e[0];return n||null};t.removeAnyChildWithName=function(e){var t=this.children,n=[],r;for(var i=0;i<t.length;i++){r=t[i];if(!r.name)continue;if(r.name==e){n.push(r);t.splice(i--,1)}n=n.concat(r.removeAnyChildWithName(e))}return n};t.getAncestor=function(e){var t=this.parent;while(t&&!(t.name&&t.name.match(e)))t=t.parent;return t};e.firstChild=t.firstChild=function(e){var t;for(var n=0;n<this.children.length;n++){t=this.children[n];if(e(t))return t;else if(t.name){t=t.firstChild(e);if(t)return t}}return null};t.addStyle=function(e,t,n){var r,i="";if(typeof t=="string")i+=e+":"+t+";";else{if(typeof e=="object"){for(var s in e){if(e.hasOwnProperty(s))i+=s+":"+e[s]+";"}}else i+=e;n=t}if(!this.attributes)this.attributes={};r=this.attributes.style||"";r=(n?[i,r]:[r,i]).join(";");this.attributes.style=r.replace(/^;|;(?=;)/,"")};t.getStyle=function(e){var t=this.attributes.style;if(t){t=CKEDITOR.tools.parseCssText(t,1);return t[e]}};CKEDITOR.dtd.parentOf=function(e){var t={};for(var n in this){if(n.indexOf("$")==-1&&this[n][e])t[n]=1}return t};var r=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i;var i=/^(?:\b0[^\s]*\s*){1,4}$/;var s="^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$",o=new RegExp(s),u=new RegExp(s.toUpperCase());var a={decimal:/\d+/,"lower-roman":o,"upper-roman":u,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},f={disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/},l={ol:a,ul:f},c=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],h="ABCDEFGHIJKLMNOPQRSTUVWXYZ";var v=0,m=null,g;var y=CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(e,t){var n=new CKEDITOR.htmlParser.element("cke:listbullet");n.attributes={"cke:listsymbol":e[0]};n.add(new CKEDITOR.htmlParser.text(t));return n},isListBulletIndicator:function(e){var t=e.attributes&&e.attributes.style;if(/mso-list\s*:\s*Ignore/i.test(t))return true},isContainingOnlySpaces:function(e){var t;return(t=e.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(t.value)},resolveList:function(e){var t=e.attributes,n;if((n=e.removeAnyChildWithName("cke:listbullet"))&&n.length&&(n=n[0])){e.name="cke:li";if(t.style){t.style=y.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(e){var n=e.split(" ");e=CKEDITOR.tools.convertToPx(n[3]||n[1]||n[0]);if(!v&&m!==null&&e>m)v=e-m;m=e;t["cke:indent"]=v&&Math.ceil(e/v)+1||1}],[/^mso-list$/,null,function(e){e=e.split(" ");var n=Number(e[0].match(/\d+/)),r=Number(e[1].match(/\d+/));if(r==1){n!==g&&(t["cke:reset"]=1);g=n}t["cke:indent"]=r}]])(t.style,e)||""}if(!t["cke:indent"]){m=0;t["cke:indent"]=1}CKEDITOR.tools.extend(t,n.attributes);return true}else g=m=v=null;return false},getStyleComponents:function(){var e=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(e);return function(t,n,r){e.setStyle(t,n);var i={},s=r.length;for(var o=0;o<s;o++)i[r[o]]=e.getStyle(r[o]);return i}}(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(e,t){t=typeof t=="number"?t:1;var n=e.attributes,i;switch(n.type){case"a":i="lower-alpha";break;case"1":i="decimal";break}var s=e.children,o;for(var u=0;u<s.length;u++){o=s[u];if(o.name in CKEDITOR.dtd.$listItem){var a=o.attributes,f=o.children,l=f.length,c=f[l-1];if(c.name in CKEDITOR.dtd.$list){e.add(c,u+1);if(!--f.length)s.splice(u--,1)}o.name="cke:li";n.start&&!u&&(a.value=n.start);y.filters.stylesFilter([["tab-stops",null,function(e){var t=e.split(" ")[1].match(r);t&&(m=CKEDITOR.tools.convertToPx(t[0]))}],t==1?["mso-list",null,function(e){e=e.split(" ");var t=Number(e[0].match(/\d+/));t!==g&&(a["cke:reset"]=1);g=t}]:null])(a.style);a["cke:indent"]=t;a["cke:listtype"]=e.name;a["cke:list-style-type"]=i}else if(o.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[o,t+1]);s=s.slice(0,u).concat(o.children).concat(s.slice(u+1));e.children=[];for(var h=0,p=s.length;h<p;h++)e.add(s[h]);s=e.children}}delete e.name;n["cke:list"]=1},assembleList:function(e){var t=e.children,r,i,s,o,u,a,f,c=[],h,y;var b,w,E,S;for(var x=0;x<t.length;x++){r=t[x];if("cke:li"==r.name){r.name="li";i=r;s=i.attributes;b=s["cke:listsymbol"];b=b&&b.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);w=E=S=null;if(s["cke:ignored"]){t.splice(x--,1);continue}s["cke:reset"]&&(f=u=a=null);o=Number(s["cke:indent"]);if(o!=u)y=h=null;if(!b){w=s["cke:listtype"]||"ol";E=s["cke:list-style-type"]}else{if(y&&l[y][h].test(b[1])){w=y;E=h}else{for(var T in l){for(var N in l[T]){if(l[T][N].test(b[1])){if(T=="ol"&&/alpha|roman/.test(N)){var C=/roman/.test(N)?p(b[1]):d(b[1]);if(!S||C<S){S=C;w=T;E=N}}else{w=T;E=N;break}}}}}!w&&(w=b[2]?"ol":"ul")}y=w;h=E||(w=="ol"?"decimal":"disc");if(E&&E!=(w=="ol"?"decimal":"disc"))i.addStyle("list-style-type",E);if(w=="ol"&&b){switch(E){case"decimal":S=Number(b[1]);break;case"lower-roman":case"upper-roman":S=p(b[1]);break;case"lower-alpha":case"upper-alpha":S=d(b[1]);break}i.attributes.value=S}if(!f){c.push(f=new CKEDITOR.htmlParser.element(w));f.add(i);t[x]=f}else{if(o>u){c.push(f=new CKEDITOR.htmlParser.element(w));f.add(i);a.add(f)}else if(o<u){var k=u-o,L;while(k--&&(L=f.parent))f=L.parent;f.add(i)}else f.add(i);t.splice(x--,1)}a=i;u=o}else if(f)f=u=a=null}for(x=0;x<c.length;x++)n(c[x]);f=u=a=g=m=v=null},falsyFilter:function(e){return false},stylesFilter:function(e,t){return function(n,r){var i=[];(n||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(n,s,o){s=s.toLowerCase();s=="font-family"&&(o=o.replace(/["']/g,""));var u,a,f,l;for(var c=0;c<e.length;c++){if(e[c]){u=e[c][0];a=e[c][1];f=e[c][2];l=e[c][3];if(s.match(u)&&(!a||o.match(a))){s=l||s;t&&(f=f||o);if(typeof f=="function")f=f(o,r,s);if(f&&f.push)s=f[0],f=f[1];if(typeof f=="string")i.push([s,f]);return}}}!t&&i.push([s,o])});for(var s=0;s<i.length;s++)i[s]=i[s].join(":");return i.length?i.join(";")+";":false}},elementMigrateFilter:function(e,t){return e?function(n){var r=t?(new CKEDITOR.style(e,t))._.definition:e;n.name=r.element;CKEDITOR.tools.extend(n.attributes,CKEDITOR.tools.clone(r.attributes));n.addStyle(CKEDITOR.style.getStyleText(r))}:function(){}},styleMigrateFilter:function(e,t){var n=this.elementMigrateFilter;return e?function(r,i){var s=new CKEDITOR.htmlParser.element(null),o={};o[t]=r;n(e,o)(s);s.children=i.children;i.children=[s];s.filter=function(){};s.parent=i}:function(){}},bogusAttrFilter:function(e,t){if(t.name.indexOf("cke:")==-1)return false},applyStyleFilter:null},getRules:function(e,t){var n=CKEDITOR.dtd,r=CKEDITOR.tools.extend({},n.$block,n.$listItem,n.$tableContent),s=e.config,o=this.filters,u=o.falsyFilter,a=o.stylesFilter,f=o.elementMigrateFilter,l=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),c=this.utils.createListBulletMarker,h=o.flattenList,p=o.assembleList,d=this.utils.isListBulletIndicator,v=this.utils.isContainingOnlySpaces,m=this.utils.resolveList,g=function(e){e=CKEDITOR.tools.convertToPx(e);return isNaN(e)?e:e+"px"},y=this.utils.getStyleComponents,b=this.utils.listDtdParents,w=s.pasteFromWordRemoveFontStyles!==false,E=s.pasteFromWordRemoveStyles!==false;return{elementNames:[[/meta|link|script/,""]],root:function(e){e.filterChildren(t);p(e)},elements:{"^":function(e){var t;if(CKEDITOR.env.gecko&&(t=o.applyStyleFilter))t(e)},$:function(e){var i=e.name||"",o=e.attributes;if(i in r&&o.style)o.style=a([[/^(:?width|height)$/,null,g]])(o.style)||"";if(i.match(/h\d/)){e.filterChildren(t);if(m(e))return;f(s["format_"+i])(e)}else if(i in n.$inline){e.filterChildren(t);if(v(e))delete e.name}else if(i.indexOf(":")!=-1&&i.indexOf("cke")==-1){e.filterChildren(t);if(i=="v:imagedata"){var u=e.attributes["o:href"];if(u)e.attributes.src=u;e.name="img";return}delete e.name}if(i in b){e.filterChildren(t);p(e)}},style:function(e){if(CKEDITOR.env.gecko){var t=e.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/),n=t&&t[1],r={};if(n){n.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(e,t,n){t=t.split(",");var i=t.length,s;for(var o=0;o<i;o++){CKEDITOR.tools.trim(t[o]).replace(/^(\w+)(\.[\w-]+)?$/g,function(e,t,i){t=t||"*";i=i.substring(1,i.length);if(i.match(/MsoNormal/))return;if(!r[t])r[t]={};if(i)r[t][i]=n;else r[t]=n})}});o.applyStyleFilter=function(e){var t=r["*"]?"*":e.name,n=e.attributes&&e.attributes["class"],i;if(t in r){i=r[t];if(typeof i=="object")i=i[n];i&&e.addStyle(i,true)}}}}return false},p:function(e){if(/MsoListParagraph/i.exec(e.attributes["class"])||e.getStyle("mso-list")){var n=e.firstChild(function(e){return e.type==CKEDITOR.NODE_TEXT&&!v(e.parent)});var r=n&&n.parent;if(r)r.addStyle("mso-list","Ignore")}e.filterChildren(t);if(m(e))return;if(s.enterMode==CKEDITOR.ENTER_BR){delete e.name;e.add(new CKEDITOR.htmlParser.element("br"))}else f(s["format_"+(s.enterMode==CKEDITOR.ENTER_P?"p":"div")])(e)},div:function(e){var t=e.onlyChild();if(t&&t.name=="table"){var n=e.attributes;t.attributes=CKEDITOR.tools.extend(t.attributes,n);n.style&&t.addStyle(n.style);var r=new CKEDITOR.htmlParser.element("div");r.addStyle("clear","both");e.add(r);delete e.name}},td:function(e){if(e.getAncestor("thead"))e.name="th"},ol:h,ul:h,dl:h,font:function(e){if(d(e.parent)){delete e.name;return}e.filterChildren(t);var n=e.attributes,r=n.style,i=e.parent;if("font"==i.name){CKEDITOR.tools.extend(i.attributes,e.attributes);r&&i.addStyle(r);delete e.name}else{r=r||"";if(n.color){n.color!="#000000"&&(r+="color:"+n.color+";");delete n.color}if(n.face){r+="font-family:"+n.face+";";delete n.face}if(n.size){r+="font-size:"+(n.size>3?"large":n.size<3?"small":"medium")+";";delete n.size}e.name="span";e.addStyle(r)}},span:function(e){if(d(e.parent))return false;e.filterChildren(t);if(v(e)){delete e.name;return null}if(d(e)){var n=e.firstChild(function(e){return e.value||e.name=="img"});var r=n&&(n.value||"l."),i=r&&r.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(i){var o=c(i,r);var u=e.getAncestor("span");if(u&&/ mso-hide:\s*all|display:\s*none /.test(u.attributes.style))o.attributes["cke:ignored"]=1;return o}}var f=e.children,h=e.attributes,p=h&&h.style,m=f&&f[0];if(p){h.style=a([["line-height"],[/^font-family$/,null,!w?l(s["font_style"],"family"):null],[/^font-size$/,null,!w?l(s["fontSize_style"],"size"):null],[/^color$/,null,!w?l(s["colorButton_foreStyle"],"color"):null],[/^background-color$/,null,!w?l(s["colorButton_backStyle"],"color"):null]])(p,e)||""}if(!h.style)delete h.style;if(CKEDITOR.tools.isEmpty(h))delete e.name;return null},b:f(s["coreStyles_bold"]),i:f(s["coreStyles_italic"]),u:f(s["coreStyles_underline"]),s:f(s["coreStyles_strike"]),sup:f(s["coreStyles_superscript"]),sub:f(s["coreStyles_subscript"]),a:function(e){var t=e.attributes;if(t.href&&t.href.match(/^file:\/\/\/[\S]+#/i))t.href=t.href.replace(/^file:\/\/\/[^#]+/i,"")},"cke:listbullet":function(e){if(e.getAncestor(/h\d/)&&!s.pasteFromWordNumberedHeadingToList)delete e.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:a(E?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(e,t,n){if(t.name in{p:1,div:1}){var r=s.contentsLangDirection=="ltr"?"margin-left":"margin-right";if(n=="margin")e=y(n,e,[r])[r];else if(n!=r)return null;if(e&&!i.test(e))return[r,e]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(e,t){if(t.name=="img")return e}],[/^width|height$/,null,function(e,t){if(t.name in{table:1,td:1,th:1,img:1})return e}]]:[[/^mso-/],[/-color$/,null,function(e){if(e=="transparent")return false;if(CKEDITOR.env.gecko)return e.replace(/-moz-use-text-color/g,"transparent")}],[/^margin$/,i],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],w?[/font-?/]:null],E),width:function(e,t){if(t.name in n.$tableContent)return false},border:function(e,t){if(t.name in n.$tableContent)return false},"class":u,bgcolor:u,valign:E?u:function(e,t){t.addStyle("vertical-align",e);return false}},comment:!CKEDITOR.env.ie?function(e,t){var n=e.match(/<img.*?>/),r=e.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(r){var i=r[1]||n&&"l.",s=i&&i.match(/>(?:[(]?)([^\s]+?)([.)]?)</);return c(s,i)}if(CKEDITOR.env.gecko&&n){var o=CKEDITOR.htmlParser.fragment.fromHtml(n[0]).children[0],u=t.previous,a=u&&u.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/),f=a&&a[1];f&&(o.attributes.src=f);return o}return false}:u}}};var b=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};b.prototype={toHtml:function(e){var t=CKEDITOR.htmlParser.fragment.fromHtml(e),n=new CKEDITOR.htmlParser.basicWriter;t.writeHtml(n,this.dataFilter);return n.getHtml(true)}};CKEDITOR.cleanWord=function(e,t){if(CKEDITOR.env.gecko)e=e.replace(/(<!--\[if[^<]*?\])-->([\S\s]*?)<!--(\[endif\]-->)/gi,"$1$2$3");if(CKEDITOR.env.webkit)e=e.replace(/(class="MsoListParagraph[^>]+><!--\[if !supportLists\]-->)([^<]+<span[^<]+<\/span>)(<!--\[endif\]-->)/gi,"$1<span>$2</span>$3");var n=new b,r=n.dataFilter;r.addRules(CKEDITOR.plugins.pastefromword.getRules(t,r));t.fire("beforeCleanWord",{filter:r});try{e=n.toHtml(e)}catch(i){alert(t.lang.pastefromword.error)}e=e.replace(/cke:.*?".*?"/g,"");e=e.replace(/style=""/g,"");e=e.replace(/<span>/g,"");return e}})()